

<!--
 * @version:
 * @Author:  StevenJokess https://github.com/StevenJokess
 * @Date: 2020-07-22 23:10:22
 * @LastEditors:  StevenJokess https://github.com/StevenJokess
 * @LastEditTime: 2020-07-22 23:41:11
 * @Description:translate by machine
 * @TODO::
 * @Reference:http://preview.d2l.ai/d2l-en/master/chapter_deep-learning-computation/read-write.html
 * https://zh.d2l.ai/chapter_deep-learning-computation/read-write.html
-->

# 文件读取和存储

到目前为止，我们讨论了如何处理数据以及如何构建，训练和测试深度学习模型。但是，在某个时候，我们希望对学习的模型感到满意，希望将结果保存起来，以备以后在各种情况下使用（甚至可能在部署中进行预测）。此外，在进行长时间的培训时，最佳实践是定期保存中间结果（检查点），以确保在服务器电源线跳闸的情况下，我们不会损失几天的计算时间。因此，我们该学习如何加载和存储单个权重向量和整个模型了。本节解决这两个问题。

## 加载和保存张量

对于单个张量，我们可以直接调用load和save函数分别读取和写入它们。这两个函数都要求我们提供一个名称，而save需要将要保存的变量作为输入。

TODO:CODE

现在，我们可以将这些数据从存储的文件读回到内存中。

TODO:CODE

我们甚至可以编写和阅读从字符串映射到张量的字典。当我们要读取或写入模型中的所有权重时，这很方便。

TODO:CODE

## 模型参数

保存单个权重向量（或其他张量）很有用，但是如果我们要保存（并在以后加载）整个模型，这将非常繁琐。毕竟，我们可能遍布数百个参数组。因此，该框架提供了内置功能来加载和保存整个网络。需要注意的重要细节是，这样可以保存模型参数，而不是整个模型。例如，如果我们有一个三层MLP，则需要单独指定体系结构。原因是模型本身可以包含任意代码，因此无法自然地对其进行序列化。因此，为了恢复模型，我们需要用代码生成体系结构，然后从磁盘加载参数。让我们从我们熟悉的MLP开始。

TODO:CODE

为了恢复模型，我们实例化原始MLP模型的一个克隆。我们没有随机初始化模型参数，而是直接读取存储在文件中的参数。

TODO:CODE

由于两个实例具有相同的模型参数，因此相同输入x的计算结果应相同。让我们验证一下。

TODO:CODE

## 小结

* `save`和`load`功能可用于对张量对象执行文件读取和存储。
* 我们可以通过参数字典`save`和`load`网络的整个参数集。
* 保存体系结构必须用代码而不是参数来完成。

## 练习

1. 即使无需将经过训练的模型部署到其他设备，存储模型参数的实际好处是什么？
1. 假设我们只想重用网络的一部分以合并到其他体系结构的网络中。例如，您将如何使用新网络中先前网络的前两层。
1. 您将如何保存网络架构和参数？ 您会对架构施加什么限制？
