

<!--
 * @version:
 * @Author:  StevenJokes https://github.com/StevenJokes
 * @Date: 2020-07-22 23:49:16
 * @LastEditors:  StevenJokes https://github.com/StevenJokes
 * @LastEditTime: 2020-07-23 00:13:03
 * @Description:
 * @TODO::
 * @Reference:http://preview.d2l.ai/d2l-en/master/chapter_deep-learning-computation/custom-layer.html
 * https://zh.d2l.ai/chapter_deep-learning-computation/custom-layer.html
-->

# 自定义层

深度学习成功的一个因素是，可以以创造性的方式组成各种层来设计适合各种任务的架构。例如，研究人员已经发明了专门用于处理图像，文本，循环访问顺序数据，执行动态编程等的层。迟早，您将遇到（或发明）框架中尚不存在的层。在这些情况下，您必须构建一个自定义层。在本节中，我们向您展示如何。

## 不含模型参数的自定义层

我们先介绍如何定义一个不含模型参数的自定义层。事实上，这和“模型构造”一节中介绍的使用Block类构造模型类似。下面的CenteredLayer类通过继承Block类自定义了一个将输入减掉均值后输出的层，并将层的计算定义在了forward函数里。这个层里不含模型参数。

TODO:CODE

让我们通过向其馈入一些数据来验证我们的层是否按预期工作。

我们还可以使用自定义图层构造模型。一旦有了，我们就可以像内置密集层一样使用它。

## 含模型参数的自定义层

现在我们知道了如何定义简单的图层，让我们继续使用可以通过训练进行调整的参数来定义图层。我们可以使用内置方法来创建参数，这些参数提供一些基本的内务管理功能。特别是，它们控制访问，初始化，共享，保存和加载模型参数。这样，除其他好处外，我们无需为每个自定义层编写自定义序列化例程。

现在，让我们实现我们自己的完全连接层版本。回想一下，该层需要两个参数，一个代表重量，另一个代表偏差。在此实现中，我们默认烘焙ReLU激活。该层需要输入参数：in_units和unit，分别表示输入和输出的数量。

TODO:CODE

我们可以使用自定义图层直接进行正向计算。

TODO:CODE

我们还可以使用自定义图层构造模型。一旦有了，我们就可以像内置密集层一样使用它。

TODO:CODE

## 小结

* 我们可以通过基本图层类设计自定义图层。这使我们能够定义灵活的新层，这些新层的行为不同于库中的任何现有层。
* 定义后，可以在任意上下文和体系结构中调用自定义层。
* 图层可以具有局部参数，可以通过内置方法创建局部参数。

## 练习

1. 自定义一个层，使用它做一次前向计算。
1. 设计一个接受输入并计算张量缩减的层。，返回yk=∑i,jWijkxixjyk=∑i,jWijkxixj。
1. 设计一个返回数据傅里叶系数前半部分的层。
