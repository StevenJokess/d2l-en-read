

<!--
 * @version:
 * @Author:  StevenJokess https://github.com/StevenJokess
 * @Date: 2020-08-15 11:54:01
 * @LastEditors:  StevenJokess https://github.com/StevenJokess
 * @LastEditTime: 2020-08-15 13:08:54
 * @Description:MT half
 * @TODO::
 * @Reference:http://preview.d2l.ai/d2l-en/master/chapter_natural-language-processing-pretraining/glove.html
-->

# 全局向量的字嵌入(GloVe)

首先，我们应该回顾 word2vec 中的跳图模型。用流程图模型表示的条件概率 p (w j w i) p (w j w i)将被记录为 qij qij j j j，即:

其中 v i vi 和 u i ui 分别作为索引 i 的中心词和上下文词的向量表示，v = {0,1，... ，| v |-1} v = {0,1，... ，| v |-1}为词汇索引集。

单词 w i wi，它可能出现在数据集中多次。以 w i i i 为中心词时，我们每次都收集所有的上下文词，并保留重复词，称为多集 c i Ci。多元集合中元素的个数称为元素的多重性。例如，假设 w i wi 在数据集中出现两次: 当这两个 w i wi 在文本序列中成为中心词时，上下文窗口包含上下文词索引2,1,5,2,1,5,2和2,3,2,12,3,2,2,1。然后，多重集 Ci = {1,1,2,2,2,2,2,3,5} Ci = {1,1,2,2,2,3,5} ，其中元素1的重数为2，元素2的重数为4，元素3和5的重数均为1。将 multiset c i Ci 中元素 j j 的多重性表示为 x ij xij: 它是整个数据集中的中心词 w i wi 在所有上下文窗口中的单词 w j wj 的个数。因此，跳图模型的损失函数可以用不同的方式表示:

TODO:MATH

我们将中心目标词 w i i 加起来得到 x i xi，然后记录条件概率 x ij/x i xi j/xi，根据中心目标词 w i wi as p ij pij 生成上下文词 w j w j。我们可以重写跳过格拉姆模型的损失函数

在上述公式中，∑ j ∈ vp ij logij ∑ j ∈ Vpijlogqij，根据模型预测的中心目标词 w i 和交叉熵计算上下文条件概率分布生成 p ij pij。该方法利用上下文字数与中心目标字数之和来加权损失函数。如果我们从上面的公式中最小化损失函数，我们将能够使预测的条件概率分布尽可能接近真正的条件概率分布。

然而，虽然最常见的损失函数类型，交叉熵损失函数有时不是一个好的选择。一方面，正如我们在第14.2节中提到的，让模型预测 qij qij 成为法律概率分布的成本是整个词典所有项目的总和的分母。这很容易导致过多的计算开销。另一方面，字典中常常有许多不常用的词，而且它们很少出现在数据集中。在交叉熵损失函数中，条件概率分布对大量不常用词的最终预测可能是不准确的。

为了解决这个问题，紧随 word2vec 之后的一个词嵌入模型 GloVe [ Pennington et al. 2014]采用了平方损失，并根据这一损失对跳过格拉姆模型做了三处修改。





在上式中，∑j∈Vpijlogqij∑j∈Vpijlogqij基于中心目标词wiwi和模型预测的条件概率分布qijqij的交叉熵，计算用于上下文词生成的条件概率分布pijpij。 损失函数使用上下文词的数量与中心目标词wiwi的总和加权。 如果我们根据上面的公式最小化损失函数，我们将能够使预测的条件概率分布尽可能接近真实的条件概率分布。

但是，尽管损失函数是最常见的类型，但是交叉熵损失函数有时并不是一个很好的选择。 一方面，正如我们在第14.2节中提到的那样，让模型预测qijqij成为合法概率分布的代价是整个词典中所有分母的总和。 这很容易导致过多的计算开销。 另一方面，字典中经常有很多不常见的单词，并且很少出现在数据集中。 在交叉熵损失函数中，对大量不常见单词的条件概率分布的最终预测可能不准确。



我们可以观察到下列现象:

* 对于与“ice”相关但与“steam”不相关的单词wkwk，比如wk=wk=“solid”，我们希望有更大的条件概率比，比如上表最后一行中的值8.9。
* 对于与“蒸汽”相关但与“冰”无关的单词wkwk，例如wk=“gas”，我们期望一个较小的条件概率比，如上表最后一行中的值0.085。
* 对于同时与“冰”和“蒸汽”有关的单词wkwk，例如wk=wk=“水”，我们期望条件概率比接近1，如上表最后一行中的值1.36。
* 对于既不与“ice”也不与“steam”相关的单词wkwk，例如wk=wk=“fashion”，我们期望条件概率比接近1，如上表最后一行中的值0.96。

我们可以看到，条件概率比可以更直观地表示不同单词之间的关系。 我们可以构造一个词向量函数来更有效地拟合条件概率比。 众所周知，要获得这种比率，需要三个词wi，wj和wk。 以wi为中心目标词的条件概率比是pij / pik。 我们可以找到一个使用单词向量来拟合此条件概率比的函数。

功能ff的可能设计在这里将不是唯一的。我们只需要考虑一个更合理的可能性。注意,条件概率比是一个标量,我们可以限制ff是一个标量函数:f(英国uj vi) = f ((uj−英国)⊤vi)(英国uj vi) = f ((uj−英国)⊤vi)。与kk交换指数jj之后,我们将能够看到,函数f (x) ff满足条件(−x) = 1 f (x) f(−x) = 1,所以一种可能性可以f (x) = exp (x) f (x) = exp⁡(x)。因此:

一种可能满足的右侧近似符号是exp (u⊤jvi)≈αpijexp⁡(uj⊤vi)≈αj,在αα是一个常数。考虑到j = xij / xipij = xij / xi,取对数后我们得到了u⊤jvi≈日志α+ logxij−logxiuj⊤vi≈日志α+ logxij−logxi。我们使用附加的偏置术语来拟合−log外置+logxi−log外置+logxi，如中心目标词偏置术语bibi和上下文词偏置术语cjcj:

TODO:MATH

对上述公式的左右两边取平方误差加权，得到GloVe的损失函数。

## 总结

* 在某些情况下，交叉熵损失函数可能有缺点。手套使用平方损失和单词向量来拟合基于整个数据集预先计算的全局统计信息。
* 任何词的中心目标词向量和上下文词向量在理论上是等价的。

## 练习

1. 如果一个单词出现在另一个单词的上下文窗口中，我们如何使用它们在文本序列中的距离来重新设计计算条件概率pijpij的方法?提示:见4.2节从纸手套[Pennington et al.， 2014]。
1. 对于任何一个词，其中心目标词偏颇词和上下文词偏颇词是否完全相等?为什么?
