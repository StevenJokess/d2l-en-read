

<!--
 * @version:
 * @Author:  StevenJokes https://github.com/StevenJokes
 * @Date: 2020-07-16 21:54:23
 * @LastEditors:  StevenJokes https://github.com/StevenJokes
 * @LastEditTime: 2020-07-16 22:21:55
 * @Description:translate by machine
 * @TODO::
 * @Reference:http://preview.d2l.ai/d2l-en/master/chapter_convolutional-neural-networks/pooling.html
-->

# 池化

通常，当我们处理图像时，我们希望逐渐降低隐藏表征的空间分辨率，聚合信息，这样我们在网络中的位置越高，每个隐藏节点敏感的接收域(在输入端)就越大。

通常我们的最终任务会问一些关于图像的全局性问题，例如，它包含一只猫吗？因此，最后一层的节点通常应该对整个输入敏感。通过逐步聚合信息，生成粗糙和粗糙的地图，我们最终实现了学习全局表示的目标，同时保留了处理中间层卷积层的所有优点。

此外，在检测较低级别的特征时，比如边缘(如第6.2节中所讨论的) ，我们通常希望我们的表示对平移具有一定的不变性。例如，如果我们用一个在黑色和白色之间有一个清晰轮廓的图像 x，并将整个图像向右移动一个像素，即 z [ i，j ] = x [ i，j + 1] ，那么新图像 z 的输出可能会有很大的不同。边缘将移动一个像素，并与它的所有激活。事实上，物体几乎不可能完全出现在同一个地方。事实上，即使使用三脚架和固定物体，由于快门的运动，相机的振动也可能使所有东西移动一个像素左右(高端相机装有特殊功能来解决这个问题)。

这一节介绍了池化层，它服务于双重目的，减轻敏感的卷积层的位置和空间下采样表示。

## 最大池化和平均池化

与卷积层一样，池化操作符由一个固定形状的窗口组成，该窗口根据其步幅滑过输入中的所有区域，计算固定形状窗口(有时称为池窗口)通过的每个位置的单一输出。然而，与卷积层中输入和内核的互相关计算不同，池层不包含任何参数(没有过滤器)。相反，池操作符是确定的，通常计算池窗口中元素的最大值或平均值。这些操作分别称为最大池(maxpooling)和平均池(average pooling)。

在这两种情况下，我们都可以将池窗口看作是从输入数组的左上角开始，然后滑过输入数组从左到右和从上到下。这两种情况都与互相关操作符一样。在池窗口访问的每个位置，它计算窗口中输入子数组的最大值或平均值(取决于使用的是最大池还是平均池)。

图6.5.1最大合并窗口形状为2222。阴影部分表示第一个输出元素和用于计算的输入元素: max (0,1,3,4) = 4 max (0,1,3,4) = 4

上面图6.5.1中的输出数组高度为2，宽度为2。这四个元素由 max 的最大值派生而来:

TODO:MATH

一个具有统一窗口形状的统一窗口层称为统一窗口层。这种池操作称为 pqpq池化。

让我们回到本节开头提到的对象边缘检测示例。现在我们将使用卷积层的输出作为2222最大池的输入。将卷积层输入设置为 x，池层输出设置为 y。不管 x [ i，j ]和 x [ i，j + 1]的值是否不同，或 x [ i，j + 1]和 x [ i，j + 2]不同，池层输出都包括 y [ i，j ] = 1。也就是说，使用2222最大合用层，我们仍然可以检测到，如果模式识别的卷积层移动不超过一个元素的高度和宽度。

在下面的代码中，我们在 pool2d 函数中实现了池层的前向计算。这个函数类似于6.2节中的 corr2d 函数。但是，这里没有内核，它将输出计算为输入中每个区域的最大值或平均值。

TODO:CODE

我们可以在上图中构造输入数组 x 来验证二维最大池层的输出。

TODO:CODE

同时，对平均池化层进行了实验。

TODO:CODE


## 填充和步幅

与卷积层一样，池化层也可以更改输出形状。 和以前一样，我们可以通过填充输入并调整步幅来更改操作以实现所需的输出形状。 我们可以通过二维最大池化层MaxPool2D演示池化层中填充和跨距的使用。 我们首先构造形状为（1、1、4、4）的输入数据，其中前两个维是批处理和通道。

TODO:CODE

默认情况下，MaxPool2D类中的步幅与池窗口具有相同的形状。 下面，我们使用形状为（3，3）的池化窗口，因此默认情况下获得的步幅形状为（3，3）。

TODO:CODE

步幅和填充可以手动指定。

TODO:CODE

当然，我们可以指定一个任意的矩形池窗口，并分别为高度和宽度指定填充和步幅。

TODO:CODE

## 多通道

在处理多通道输入数据时，池化层单独池化每个输入通道，而不是像卷积层那样逐个通道添加每个通道的输入。这意味着池化层的输出通道数量与输入通道数量相同。下面，我们将在通道维度上连接数组X和X+1，以构造具有两个通道的输入。

TODO:CODE

我们可以看到，合并后输出通道的数量仍然是2。

TODO:CODE

## 小结

* 以池化窗口中的输入元素为例，最大池化操作将最大值作为输出，而平均池化操作将平均值作为输出。
* 池化层的主要功能之一是减轻卷积层对位置的过度敏感性。
* 我们可以为池化层指定填充和跨度。
* 最大池合并步幅大于1的组合可用于降低分辨率。
* 池层的输出通道数与输入通道数相同。

## 练习

1. 您可以将平均池作为卷积层的特例来实现吗？ 如果是这样，请执行此操作。
1. 您可以将最大池作为卷积层的特例来实现吗？ 如果是这样，请执行此操作。
1. 池化层的计算成本是多少？ 假设到池化层的输入大小为c×h×wc×h×w，池化窗口的形状为ph×pwph×pw，填充为（ph，pw）（ph，pw），跨度为 的（sh，sw）（sh，sw）。
1. 您为什么期望最大池化和平均池化会有所不同？
1. 我们是否需要一个单独的最小池化层？ 可以用其他手术代替吗？
1. 您可以考虑在平均池和最大池之间进行其他操作（提示：调用softmax）吗？ 为什么它不那么受欢迎？
