

<!--
 * @version:
 * @Author:  StevenJokess https://github.com/StevenJokess
 * @Date: 2020-07-16 20:38:30
 * @LastEditors:  StevenJokess https://github.com/StevenJokess
 * @LastEditTime: 2020-07-16 21:34:55
 * @Description:translate by machine
 * @TODO::
 * @Reference:http://preview.d2l.ai/d2l-en/PR-1185/chapter_convolutional-neural-networks/padding-and-strides.html
-->

# 填充和步幅

在上一节的例子里，我们使用高和宽为3的输入与高和宽为2的卷积核得到高和宽为2的输出。一般来说，假设输入形状是 nh×nw ，卷积核窗口形状是 kh×kw ，那么输出形状将会是

TODO:MATH

因此，卷积层的输出形状由输入的形状和卷积核窗口的形状确定。

在某些情况下，我们采用了会影响输出大小的技术，包括填充和跨步卷积。作为动机，请注意，由于内核通常具有大于1的宽度和高度，因此在应用了许多连续的卷积之后，最终趋向于获得比输入小得多的输出。如果我们以240×240像素的图像开始，则10层5×5卷积将图像缩小为200×200像素，将图像切成30％，并消除了所有有趣的信息 原始图像的边界。填充是处理此问题的最受欢迎的工具。

在其他情况下，我们可能希望大幅降低维数，例如，如果我们发现原始输入分辨率过高。交叉卷积是一种流行的技术，可以在这些情况下提供帮助。

## 填充

如上所述，在应用卷积图层时，一个棘手的问题是我们往往会在图像周边丢失像素。由于我们通常使用小内核，对于任何给定的卷积，我们可能只损失几个像素，但这可以加起来，因为我们应用了许多连续的卷积层。这个问题的一个直接的解决方案是在输入图像的边界周围添加额外的像素填充物，从而增加图像的有效尺寸。通常，我们将额外像素的值设置为00。在: numref: img conv pad 中，我们输入3×3 ，将其大小增加到 5×5。然后相应的输出增加到4444矩阵。

图6.3.1带填充的二维互相关。阴影部分是第一个输出元素使用的输入和核心数组元素: 00 + 01 + 02 + 03 = 000 + 01 + 02 + 03 = 0。

一般来说，如果我们总共添加一行 p h的填充(大约一半在顶部，一半在底部)和一列 p w的填充(大约一半在左边，一半在右边) ，输出形状将是

TODO:MATH

这意味着输出的高度和宽度将分别增加 p h和 p w。

在许多情况下，我们希望设置 p h = k h-1 ph = kh-1和 p w = k w-1 pw = kw-1，以使输入和输出具有相同的高度和宽度。这将使得在构建网络时更容易预测每一层的输出形状。假设 k h kh 在这里是奇数，我们将在高度的两边填充 p h/2 ph/2行。如果 k h kh 是偶数，一种可能性是在输入的顶部填写 p h/2 something ph/2 something 行，在底部填写 p h/2 something ph/2 something 行。我们将用同样的方法填充宽度的两边。

卷积神经网络通常使用具有奇数高宽值的卷积核，如1、3、5或7。选择奇数核大小的好处是，我们可以在顶部和底部填充相同数量的行以及在左右填充相同数量的列的同时保持空间维度。

此外，这种使用奇数内核和填充来精确保持维度的做法还有一个办事员的好处。对于任何二维数组 x，当内核大小为奇数且所有边的填充行和列数相同时，产生与输入高度和宽度相同的输出时，我们知道输出 y [ i，j ]是由输入内核的互相关和以 x [ i，j ]为中心的窗口的卷积计算出来的。

在下面的例子中，我们创建了一个高度和宽度为3的二维卷积层，并在所有边上应用了11像素的填充。给定一个高度和宽度为8的输入，我们发现输出的高度和宽度也是8。

TODO:CODE

当卷积核的高度和宽度不同时，我们可以通过对高度和宽度设置不同的填充数，使输出和输入具有相同的高度和宽度。

TODO:CODE

## 步幅

在计算互相关时，我们从输入数组左上角的卷积窗口开始，然后将其在所有位置上下左右滑动。在前面的示例中，我们默认一次滑动一个像素。但是，有时为了提高计算效率或由于我们希望进行降采样，我们一次将窗口移动一个以上像素，从而跳过了中间位置。

我们将每个幻灯片的行数和列数称为步幅。到目前为止，高度和宽度都使用了11的步幅。有时，我们可能希望使用更大的步幅。图6.3.2显示了二维互相关操作，垂直步幅为33，水平步幅为22。我们可以看到，当输出第一列的第二个元素时，卷积窗口向下滑动三行。当输出第一行的第二个元素时，卷积窗口向右滑动两列。当卷积窗口在输入上向右滑动三列时，由于输入元素无法填充窗口而没有输出（除非我们添加另一列填充）。

图6.3.2跨度分别为3和2的高度和宽度的互相关。阴影部分是输出元素以及计算中使用的输入和核心数组元素：0×0 + 0×1 + 1×2 + 2×3 = 8，0×0 + 6×1 + 0×2 + 0×3 = 6。

通常，当高度的步幅为sh，宽度的步幅为sw时，输出形状为

（6.3.3）

⌊（nh-kh + ph + sh）/sh⌋×⌊（nw-kw + pw + sw）/sw⌋。

如果我们设置ph = kh-1且pw = kw-1，则输出形状将简化为⌊（nh + sh-1）/sh⌋×⌊（nw + sw-1 ）/sw⌋。再进一步，如果输入的高度和宽度可以被高度和宽度的步幅整除，则输出形状将为(nh / sh)×(nw / sw)。

在下面，我们将高度和宽度的跨度都设置为2，从而将输入的高度和宽度减半。

TODO:CODE

接下来，我们来看一个稍微复杂的例子。

TODO:CODE

为简便起见，当输入高度和宽度两边的填充数分别为ph和pw时，我们称之为填充(ph,pw)。具体来说，当ph=pw=p时，填充为p。当高度和宽度上的步幅分别为sh和sw时，我们称步幅(sh,sw)。具体来说，sh=sw=s时，步幅是s。默认情况下，padding是0，stride是1。在实践中，我们很少使用不均匀的跨步或填充。，我们通常有ph=pw和sh=sw。

## 小结

* 填充可以增加输出的高度和宽度。这通常用于使输出与输入具有相同的高度和宽度。
* 步幅可以降低输出的分辨率，例如将输出的高度和宽度降低到输入高度和宽度的1/n (n是大于1的整数)。
* 利用填充和步幅可以有效地调整数据的维数。

## 练习

1. 对于本节的最后一个示例，使用形状计算公式计算输出的形状，看是否与实验结果一致。
1. 在本节的实验中尝试其他的填充和步幅组合。
1. 对于音频信号，2步对应什么?
1. 大于1的步幅的计算好处是什么?
