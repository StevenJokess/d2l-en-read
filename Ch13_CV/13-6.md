

<!--
 * @version:
 * @Author:  StevenJokes https://github.com/StevenJokes
 * @Date: 2020-07-30 18:42:32
 * @LastEditors:  StevenJokes https://github.com/StevenJokes
 * @LastEditTime: 2020-07-30 18:48:53
 * @Description:MT
 * @TODO::
 * @Reference:http://preview.d2l.ai/d2l-en/master/chapter_preface/index.html
-->

# 目标检测数据集

在目标检测数据库领域, 没有像 MNIST 或者 fashion-MNIST 这样的小型数据集。为了快速测试模型，我们将组合一个小数据集。首先，我们用办公室里的免费香蕉生成1000张不同角度和大小的香蕉图片。然后，我们收集一系列的背景图像，并在每个图像的随机位置放置一个香蕉图像。我们使用 MXNet 提供的 im2rec 工具将图像转换为二进制 RecordIO 格式[1]。这种格式可以减少数据集在磁盘上的存储开销，提高读取效率。如果您想了解更多关于如何阅读图像的信息，请参考 GluonCV Toolkit 的文档。

## 下载数据集

可以直接从互联网上下载 RecordIO 格式的香蕉探测数据集。

TODO:CODE

## 读取数据集

我们将通过创建实例 imagedeteter 来读取目标检测数据集。名称中的“ Det”指的是侦查。我们将以随机顺序读取训练数据集。由于数据集的格式是 RecordIO，我们需要图像索引文件“ train.idx”来读取随机的小批处理。此外，对于训练集的每个图像，我们将使用随机裁剪，并要求裁剪后的图像至少覆盖每个对象的95% 。由于种植是随机的，这一要求并不总是得到满足。我们预设最大随机裁剪次数为200次。如果没有一个符合要求，图像将不被裁剪。为了确保输出的确定性，我们不会随机裁剪测试数据集中的图像。我们也不需要以随机顺序读取测试数据集。

TODO:CODE

下面，我们阅读一个小批量和打印的形状的图像和标签。图像的形状与前面的实验相同(批量大小，通道数量，高度，宽度)。标签的形状是(批量大小，m m，5) ，其中 m m 等于数据集中单个图像中包含的最大边界框数。尽管小批量的计算非常有效，但是它要求每个图像包含相同数量的包围盒，这样它们就可以放在同一批量中。由于每个图像可能有不同数量的边界框，我们可以添加非法的边界框到图像中有少于 m 的边界框，直到每个图像包含 m 的边界框。因此，我们可以每次读取一小批图像。图像中每个边界框的标签由长度为5的数组表示。数组中的第一个元素是包含在边界框中的对象的类别。当值为 -1时，为了填充，包围盒是一个非法的包围盒。数组的其余四个元素表示包围盒左上角的 x、 y、 x 轴坐标和包围盒右下角的 x、 y、 x 轴坐标(值范围在0和1之间)。这里的 banana 数据集每个图像只有一个边界框，所以 m = 1。

TODO:CODE

## 示范

我们有10个带有边框的图像。我们可以看到香蕉的角度、大小和位置在每个图像中都是不同的。当然，这是一个简单的人工数据集。在实际操作中，数据通常要复杂得多。

TODO:CODE

## 小结

* 我们合成的香蕉检测数据集可以用来测试目标检测模型。
* 目标检测的数据读取与图像分类的数据读取相似。但是在引入边框后，标签的形状和图像的增强(如随机裁剪)发生了变化。

## 练习

1. 参考MXNet文档，映像构造函数的参数是什么?ImageDetIter和图像。CreateDetAugmenter课吗?它们的意义是什么?
